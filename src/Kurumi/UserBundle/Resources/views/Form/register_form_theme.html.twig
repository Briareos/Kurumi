{% block _user_register_profile_birthday_widget %}
{% spaceless %}
{% if widget == 'single_text' %}
{{ block('form_widget_simple') }}
{% else %}
<div {{ block('widget_container_attributes') }}>
    {{ date_pattern|replace({
                '{{ year }}':  form_widget(form.year, {attr:{class:'input-small'} }),
                '{{ month }}': form_widget(form.month, {attr:{class:'input-small'} }),
                '{{ day }}':   form_widget(form.day, {attr:{class:'input-small'} }),
            })|raw }}
</div>
{% endif %}
{% endspaceless %}
{% endblock _user_register_profile_birthday_widget %}

{% block _user_register_profile_gender_widget %}
{% spaceless %}
<div class="input-prepend input-append">
    <div class="add-on">{{ form_widget(form['0']) }}</div>
    {{ form_label(form['0'],'form.register.gender.male',{label_attr:{class:'btn label-male'}}) }}
    {{ form_label(form['1'],'form.register.gender.female',{label_attr:{class:'btn label-female'}}) }}
    <div class="add-on">{{ form_widget(form['1']) }}</div>
</div>
{% endspaceless %}
{% endblock _user_register_profile_gender_widget %}

{% block _user_register_timezone_widget %}
{{ form_widget(form) }}
{% spaceless %}
<script>
    $(document).ready(function () {
        var registerTimezone = function () {
            var timezone = window.jstz.determine_timezone();
            $('#{{ id }}').val(timezone.name());
        };
        if (typeof window.jstz === 'undefined') {
            $.ajax({
                url:"{{ asset('js/jstz.min.js') }}",
                datType:"script",
                success:registerTimezone
            });
        } else {
            registerTimezone();
        }
    });
</script>
{% endspaceless %}
{% endblock _user_register_timezone_widget %}

{% block _user_register_profile_city_widget %}
{{ form_widget(form) }}
{% spaceless %}
<script>
    $(document).ready(function () {
        var labels = [], mapped = {}, timezone;
        $('#{{ id }}').typeahead({
            source:function (query, process) {
                $.getJSON('http://ws.geonames.org/searchJSON', {
                    username:"grayfox",
                    lang:"en",
                    style:"full",
                    featureClass:"P",
                    maxRows:8,
                    country:"RS",
                    name_startsWith:query.split(',').shift()
                }, function (data) {
                    labels = [];
                    mapped = {};
                    $.each(data.geonames,
                            function (i, item) {
                                if (item.countryCode === "US") {
                                    item.label = item.name + (item.adminName1 ? ", " + item.adminName1 : "") + ", US";
                                } else {
                                    item.label = item.name + ", " + item.countryName;
                                }
                                labels.push(item.label);
                                mapped[item.label] = item;
                            }).sort(function (a, b) {
                                if (a.population === b.population) {
                                    return 0;
                                } else {
                                    return (a.population < b.population) ? 1 : -1;
                                }
                            });
                    process(labels);
                });
            }, updater:function (item) {
                var data = mapped[item];
                return item;
            }
        });
    })
</script>
{% endspaceless %}
{% endblock _user_register_profile_city_widget %}